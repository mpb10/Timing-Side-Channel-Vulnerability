<#
.SYNOPSIS 
	These are three PowerShell scripts that demonstrate, in a very basic manner, what timing side-channel vulnerabilities are.
	
.DESCRIPTION 
	This script fixes the timing side-channel vulnerability in a different way by continuing through the while-loop even after the script realizes that the hashes don't match, thus ensuring that the results are always returned after the same amount of time.
	
.PARAMETER Hash1 
	A 32 character string that is meant to represent an MD5 hash.
.PARAMETER Hash2 
	A 32 character string that is meant to represent an MD5 hash.
	
.EXAMPLE 
	.\SecureScript-Option2.ps1 5f4dcc3b5aa765d61d8327deb882cf99 5f4dcc3b5aa763dfj63575d83eb2c3go
	Compares two hashes that do not match. Sets a flag when the script realizes that the hashes do not match but continues through the rest of the while-loop.
.EXAMPLE 
	.\SecureScript-Option2.ps1 5f4dcc3b5aa765d61d8327deb882cf99 5f4dcc3b5aa765d61d8327deb882cf99
	Compares two matching hashes.

.NOTES 
	Author: mpb10
	Updated: April 25th, 2018
	Version: 1.0.0
.LINK 
	https://github.com/mpb10/Timing-Side-Channel-Vulnerability
#>

# Example hash of the word 'password': 5f4dcc3b5aa765d61d8327deb882cf99

Param(
	[Parameter(Position = 0,Mandatory = $True)]
	[ValidateLength(32,32)]
	[String]$Hash1,
	[Parameter(Position = 1,Mandatory = $True)]
	[ValidateLength(32,32)]
	[String]$Hash2
)

Write-Host "Comparing hashes:`n    $Hash1`n    $Hash2"

# Flag variable used to determine if the hashes match or not.
$MatchStatus = $True

# Flag variable used to keep the processing time consistent. NOT used to determine match.
$UnusedVariable = $True

$i = 0

$TimeToCompare = Measure-Command {
	While ($i -lt 32) {
		Write-Verbose "Testing position: $i"
		
		If ($Hash1.Chars($i) -clike $Hash2.Chars($i)) {
			$UnusedVariable = $False
		}
		Else {
			$MatchStatus = $False
		}
		
		$i++
		Start-Sleep -Milliseconds 500
	}
	
	If ($MatchStatus -eq $True) {
	Write-Host "`nHashes match.`n" -ForegroundColor "Green"
	}
	Else {
		Write-Host "`nHashes do not match.`n" -ForegroundColor "Red"
	}
}

Write-Host "Finished. Time: $TimeToCompare" -ForegroundColor "Yellow"

